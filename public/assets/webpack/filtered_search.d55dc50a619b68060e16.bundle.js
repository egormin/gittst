webpackJsonp(["filtered_search"],{"./droplab/plugins/ajax.js":function(e,t,n){"use strict";var r=n("./lib/utils/ajax_cache.js"),i={_loadData:function(e,t,n){if(t.loadingTemplate){var r=n.hook.list.list.querySelector("[data-loading-template]");r&&(r.outerHTML=n.listTemplate)}n.destroyed||n.hook.list[t.method].call(n.hook.list,e)},init:function(e){var t=this;t.destroyed=!1;var n=e.config.Ajax;if(this.hook=e,n&&n.endpoint&&n.method&&("setData"===n.method||"addData"===n.method)){if(n.loadingTemplate){var i=e.list.list.querySelector("[data-dynamic]"),a=document.createElement("div");a.innerHTML=n.loadingTemplate,a.setAttribute("data-loading-template",""),this.listTemplate=i.outerHTML,i.outerHTML=a.outerHTML}r.a.retrieve(n.endpoint).then(function(e){return t._loadData(e,n,t)}).catch(n.onError)}},destroy:function(){this.destroyed=!0}};t.a=i},"./droplab/plugins/ajax_filter.js":function(e,t,n){"use strict";var r=n("./lib/utils/ajax_cache.js"),i={init:function(e){this.destroyed=!1,this.hook=e,this.notLoading(),this.eventWrapper={},this.eventWrapper.debounceTrigger=this.debounceTrigger.bind(this),this.hook.trigger.addEventListener("keydown.dl",this.eventWrapper.debounceTrigger),this.hook.trigger.addEventListener("focus",this.eventWrapper.debounceTrigger),this.trigger(!0)},notLoading:function(){this.loading=!1},debounceTrigger:function(e){var t=[16,17,18,20,37,38,39,40,91,93],n=t.indexOf(e.detail.which||e.detail.keyCode)>-1,r="focus"===e.type;n||this.loading||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.trigger.bind(this,r),200))},trigger:function(e){var t=this,n=this.hook.config.AjaxFilter,i=this.trigger.value;if(n&&n.endpoint&&n.searchKey){if(n.searchValueFunction&&(i=n.searchValueFunction()),n.loadingTemplate&&void 0===this.hook.list.data||0===this.hook.list.data.length){var a=this.hook.list.list.querySelector("[data-dynamic]"),o=document.createElement("div");o.innerHTML=n.loadingTemplate,o.setAttribute("data-loading-template",!0),this.listTemplate=a.outerHTML,a.outerHTML=o.outerHTML}if(e&&(i=""),n.searchKey===i)return this.list.show();this.loading=!0;var s=n.params||{};s[n.searchKey]=i;var l=n.endpoint+this.buildParams(s);return r.a.retrieve(l).then(function(e){t._loadData(e,n),n.onLoadingFinished&&n.onLoadingFinished(e)}).catch(n.onError)}},_loadData:function(e,t){var n=this.hook.list;if(t.loadingTemplate&&void 0===n.data||0===n.data.length){var r=n.list.querySelector("[data-loading-template]");r&&(r.outerHTML=this.listTemplate)}if(!this.destroyed){var i=n.list.children;1===i.length&&i[0].hasAttribute("data-dynamic")&&0===e.length&&n.hide(),n.setData.call(n,e)}this.notLoading(),n.currentIndex=0},buildParams:function(e){return e?"?"+Object.keys(e).map(function(t){return t+"="+(e[t]||"")}).join("&"):""},destroy:function(){this.timeout&&clearTimeout(this.timeout),this.destroyed=!0,this.hook.trigger.removeEventListener("keydown.dl",this.eventWrapper.debounceTrigger),this.hook.trigger.removeEventListener("focus",this.eventWrapper.debounceTrigger)}};t.a=i},"./droplab/plugins/filter.js":function(e,t,n){"use strict";var r={keydown:function(e){if(!this.destroyed){var t,n=0,r=0,i=e.detail.hook.list,a=i.data,o=e.detail.hook.trigger.value.toLowerCase(),s=e.detail.hook.config.Filter,l=[];a&&(t=s&&s.filterFunction&&"function"==typeof s.filterFunction?s.filterFunction:function(e){return e.droplab_hidden=-1===e[s.template].toLowerCase().indexOf(o),e},r=a.filter(function(e){return!e.droplab_hidden}).length,l=a.map(function(e){return t(e,o)}),n=l.filter(function(e){return!e.droplab_hidden}).length,r!==n&&(i.setData(l),i.currentIndex=0))}},debounceKeydown:function(e){[13,16,17,18,20,37,38,39,40,91,92,93].indexOf(e.detail.which||e.detail.keyCode)>-1||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.keydown.bind(this,e),200))},init:function(e){var t=e.config.Filter;t&&t.template&&(this.hook=e,this.destroyed=!1,this.eventWrapper={},this.eventWrapper.debounceKeydown=this.debounceKeydown.bind(this),this.hook.trigger.addEventListener("keydown.dl",this.eventWrapper.debounceKeydown),this.hook.trigger.addEventListener("mousedown.dl",this.eventWrapper.debounceKeydown),this.debounceKeydown({detail:{hook:this.hook}}))},destroy:function(){this.timeout&&clearTimeout(this.timeout),this.destroyed=!0,this.hook.trigger.removeEventListener("keydown.dl",this.eventWrapper.debounceKeydown),this.hook.trigger.removeEventListener("mousedown.dl",this.eventWrapper.debounceKeydown)}};t.a=r},"./filtered_search/components/recent_searches_dropdown_content.js":function(e,t,n){"use strict";var r=n("./filtered_search/event_hub.js");t.a={name:"RecentSearchesDropdownContent",props:{items:{type:Array,required:!0},isLocalStorageAvailable:{type:Boolean,required:!1,default:!0},allowedKeys:{type:Array,required:!0}},computed:{processedItems:function(){var e=this;return this.items.map(function(t){var n=gl.FilteredSearchTokenizer.processTokens(t,e.allowedKeys),r=n.tokens,i=n.searchToken;return{text:t,tokens:r.map(function(e){return{prefix:e.key+":",suffix:""+e.symbol+e.value}}),searchToken:i}})},hasItems:function(){return this.items.length>0}},methods:{onItemActivated:function(e){r.a.$emit("recentSearchesItemSelected",e)},onRequestClearRecentSearches:function(e){e.stopPropagation(),r.a.$emit("requestClearRecentSearches")}},template:'\n    <div>\n      <div\n        v-if="!isLocalStorageAvailable"\n        class="dropdown-info-note">\n        This feature requires local storage to be enabled\n      </div>\n      <ul v-else-if="hasItems">\n        <li\n          v-for="(item, index) in processedItems"\n          :key="index">\n          <button\n            type="button"\n            class="filtered-search-history-dropdown-item"\n            @click="onItemActivated(item.text)">\n            <span>\n              <span\n                v-for="(token, tokenIndex) in item.tokens"\n                class="filtered-search-history-dropdown-token">\n                <span class="name">{{ token.prefix }}</span><span class="value">{{ token.suffix }}</span>\n              </span>\n            </span>\n            <span class="filtered-search-history-dropdown-search-token">\n              {{ item.searchToken }}\n            </span>\n          </button>\n        </li>\n        <li class="divider"></li>\n        <li>\n          <button\n            type="button"\n            class="filtered-search-history-clear-button"\n            @click="onRequestClearRecentSearches($event)">\n            Clear recent searches\n          </button>\n        </li>\n      </ul>\n      <div\n        v-else\n        class="dropdown-info-note">\n        You don\'t have any recent searches\n      </div>\n    </div>\n  '}},"./filtered_search/container.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=document,o=function(){function e(){r(this,e)}return i(e,[{key:"container",set:function(e){a=e},get:function(){return a}}]),e}();t.a=new o},"./filtered_search/dropdown_hint.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n("./droplab/plugins/filter.js"),s=n("./filtered_search/filtered_search_dropdown.js"),l=(n.n(s),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),c=function(e){function t(e,n,a,o,s){r(this,t);var l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,a,s));return l.config={Filter:{template:"hint",filterFunction:gl.DropdownUtils.filterHint.bind(null,{input:a,allowedKeys:o.getKeys()})}},l.tokenKeys=o,l}return a(t,e),l(t,[{key:"itemClicked",value:function(e){var t=e.detail.selected;if("LI"===t.tagName)if(t.hasAttribute("data-value"))this.dismissDropdown();else if("submit"===t.getAttribute("data-action"))this.dismissDropdown(),this.dispatchFormSubmitEvent();else{var n=t.querySelector(".js-filter-hint").innerText.trim(),r=t.querySelector(".js-filter-tag").innerText.trim();if(r.length){var i=this.input.value.split(" "),a=[];i.forEach(function(e,t){a.push(e),t===i.length-1&&-1!==n.indexOf(e.toLowerCase())&&a.pop()}),a.length>0&&gl.FilteredSearchVisualTokens.addSearchVisualToken(a.join(" ")),gl.FilteredSearchDropdownManager.addWordToInput(n.replace(":",""),"",!1,this.container)}this.dismissDropdown(),this.dispatchInputEvent()}}},{key:"renderContent",value:function(){var e=gl.FilteredSearchTokenKeys.get().map(function(e){return{icon:"fa-"+e.icon,hint:e.key,tag:"<"+e.symbol+e.key+">",type:e.type}});this.droplab.changeHookList(this.hookId,this.dropdown,[o.a],this.config),this.droplab.setData(this.hookId,e)}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[o.a],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownHint=c},"./filtered_search/dropdown_non_user.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n("./droplab/plugins/ajax.js"),s=n("./droplab/plugins/filter.js"),l=n("./filtered_search/filtered_search_dropdown.js"),c=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),u=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},d=function(e){function t(e,n,a,o,s,l,c){r(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,a,s));return u.symbol=c,u.config={Ajax:{endpoint:l,method:"setData",loadingTemplate:u.loadingTemplate,onError:function(){new Flash("An error occured fetching the dropdown data.")}},Filter:{filterFunction:gl.DropdownUtils.filterWithSymbol.bind(null,u.symbol,a),template:"title"}},u}return a(t,e),c(t,[{key:"itemClicked",value:function(e){var n=this;u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"itemClicked",this).call(this,e,function(e){var t=e.querySelector(".js-data-value").innerText.trim();return""+n.symbol+gl.DropdownUtils.getEscapedText(t)})}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.droplab.changeHookList(this.hookId,this.dropdown,[o.a,s.a],this.config),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderContent",this).call(this,e)}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[o.a,s.a],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownNonUser=d},"./filtered_search/dropdown_user.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n("./droplab/plugins/ajax_filter.js"),s=n("./filtered_search/filtered_search_dropdown.js"),l=(n.n(s),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},u=function(e){function t(e,n,a,o,s){r(this,t);var l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,a,s));return l.config={AjaxFilter:{endpoint:(gon.relative_url_root||"")+"/autocomplete/users.json",searchKey:"search",params:{per_page:20,active:!0,project_id:l.getProjectId(),current_user:!0},searchValueFunction:l.getSearchInput.bind(l),loadingTemplate:l.loadingTemplate,onLoadingFinished:function(){l.hideCurrentUser()},onError:function(){new Flash("An error occured fetching the dropdown data.")}}},l.tokenKeys=o,l}return a(t,e),l(t,[{key:"hideCurrentUser",value:function(){this.dropdown.querySelector(".js-current-user").classList.add("hidden")}},{key:"itemClicked",value:function(e){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"itemClicked",this).call(this,e,function(e){return e.querySelector(".dropdown-light-content").innerText.trim()})}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.droplab.changeHookList(this.hookId,this.dropdown,[o.a],this.config),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderContent",this).call(this,e)}},{key:"getProjectId",value:function(){return this.input.getAttribute("data-project-id")}},{key:"getSearchInput",value:function(){var e=gl.DropdownUtils.getSearchInput(this.input),t=gl.FilteredSearchTokenizer.processTokens(e,this.tokenKeys.get()),n=t.lastToken,r=n||"";return"@"===r[0]&&(r=r.slice(1)),'"'!==r[0]&&"'"!==r[0]||(r=r.slice(1)),r}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[o.a],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownUser=u},"./filtered_search/dropdown_utils.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./filtered_search/container.js"),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return a(e,null,[{key:"getEscapedText",value:function(e){var t=e,n=-1!==e.indexOf(" "),r=-1!==e.indexOf('"');return n&&(t=r?"'"+e+"'":'"'+e+'"'),t}},{key:"filterWithSymbol",value:function(e,t,n){var r=n,i=gl.DropdownUtils.getSearchInput(t),a=r.title.toLowerCase(),o=i.toLowerCase(),s="";o[0]===e&&(s=o[0],o=o.slice(1)),'"'!==o[0]&&"'"!==o[0]||-1===a.indexOf(" ")||(o=o.slice(1));var l=s===e&&-1!==a.indexOf(o),c=-1!==a.indexOf(""+s+o);return r.droplab_hidden=!c&&!l,r}},{key:"filterHint",value:function(e,t){var n=e.input,r=e.allowedKeys,i=t,a=gl.DropdownUtils.getSearchQuery(n),o=gl.FilteredSearchTokenizer.processTokens(a,r),s=o.lastToken,l=o.tokens,c=s.key||s||"",u="array"===t.type,d=l.some(function(e){return e.key===t.hint});if(!u&&d)i.droplab_hidden=!0;else if(c&&" "!==a.split("").last()){if(c){var h=c.split(":"),p=h[0].split(" ").last(),f=-1===i.hint.indexOf(p.toLowerCase());i.droplab_hidden=!!p&&f}}else i.droplab_hidden=!1;return i}},{key:"setDataValueIfSelected",value:function(e,t){var n=t.getAttribute("data-value");return n&&gl.FilteredSearchDropdownManager.addWordToInput(e,n,!0),null!==n}},{key:"getSearchQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i.a.container,n=[].slice.call(t.querySelectorAll(".tokens-container li")),r=[];if(e){var a=_.findIndex(n,function(e){return e.classList.contains("input-token")});n.splice(a+1)}return n.forEach(function(e){if(e.classList.contains("js-visual-token")){var t=e.querySelector(".name"),n=e.querySelector(".value"),a=e.querySelector(".value-container"),o=n&&n.dataset.symbol?n.dataset.symbol:"",s="";a&&a.dataset.originalValue?s=a.dataset.originalValue:n&&n.innerText&&(s=n.innerText),-1!==e.className.indexOf("filtered-search-token")?r.push(t.innerText.toLowerCase()+":"+o+s):r.push(t.innerText)}else if(e.classList.contains("input-token")){var l=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),c=l.isLastVisualTokenValid,u=i.a.container.querySelector(".filtered-search"),d=u&&u.value;if(c)r.push(d);else{var h=r.pop();r.push(""+h+d)}}}),r.map(function(e){return e.trim()}).join(" ")}},{key:"getSearchInput",value:function(e){var t=e.value,n=gl.DropdownUtils.getInputSelectionPosition(e),r=n.right;return t.slice(0,r)}},{key:"getInputSelectionPosition",value:function(e){var t=e.selectionStart,n=e.value;n=n.replace(/(('[^']*'{0,1})|("[^"]*"{0,1})|:\s+)/g,function(e){return e.replace(/\s/g,"_")});var r=n.slice(t).search(/\s/);r>=0?r+=t:r<0&&(r=n.length);var i=n.slice(0,r).search(/\S+$/);return 0===t?i=0:t===n.length&&i<0?i=n.length:i<0&&(i=t),{left:i,right:r}}}]),e}();window.gl=window.gl||{},gl.DropdownUtils=o},"./filtered_search/event_hub.js":function(e,t,n){"use strict";var r=n("../../../node_modules/vue/dist/vue.esm.js");t.a=new r.default},"./filtered_search/filtered_search_bundle.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n("./filtered_search/dropdown_hint.js"),n("./filtered_search/dropdown_non_user.js"),n("./filtered_search/dropdown_user.js"),n("./filtered_search/dropdown_utils.js"),n("./filtered_search/filtered_search_token_keys.js")),i=(n.n(r),n("./filtered_search/filtered_search_dropdown_manager.js"),n("./filtered_search/filtered_search_dropdown.js"));n.n(i),n("./filtered_search/filtered_search_manager.js"),n("./filtered_search/filtered_search_tokenizer.js"),n("./filtered_search/filtered_search_visual_tokens.js")},"./filtered_search/filtered_search_dropdown.js":function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,i,a){n(this,e),this.droplab=t,this.hookId=i&&i.id,this.input=i,this.filter=a,this.dropdown=r,this.loadingTemplate='<div class="filter-dropdown-loading">\n      <i class="fa fa-spinner fa-spin"></i>\n    </div>',this.bindEvents()}return r(e,[{key:"bindEvents",value:function(){this.itemClickedWrapper=this.itemClicked.bind(this),this.dropdown.addEventListener("click.dl",this.itemClickedWrapper)}},{key:"unbindEvents",value:function(){this.dropdown.removeEventListener("click.dl",this.itemClickedWrapper)}},{key:"getCurrentHook",value:function(){var e=this;return this.droplab.hooks.filter(function(t){return t.id===e.hookId})[0]||null}},{key:"itemClicked",value:function(e,t){var n=e.detail.selected;if("LI"===n.tagName&&n.innerHTML){if(!gl.DropdownUtils.setDataValueIfSelected(this.filter,n)){var r=t(n);gl.FilteredSearchDropdownManager.addWordToInput(this.filter,r,!0)}this.resetFilters(),this.dismissDropdown(),this.dispatchInputEvent()}}},{key:"setAsDropdown",value:function(){this.input.setAttribute("data-dropdown-trigger","#"+this.dropdown.id)}},{key:"setOffset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;window.innerWidth>480?this.dropdown.style.left=e+"px":this.dropdown.style.left="0px"}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getCurrentHook();e&&t&&t.list.hidden&&t.list.show()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setAsDropdown();var n=this.getCurrentHook();null===n||e?this.renderContent(t):n.list.list.id!==this.dropdown.id&&this.renderContent(t)}},{key:"dismissDropdown",value:function(){this.input.focus()}},{key:"dispatchInputEvent",value:function(){this.input.dispatchEvent(new CustomEvent("input",{bubbles:!0,cancelable:!0}))}},{key:"dispatchFormSubmitEvent",value:function(){this.input.form.dispatchEvent(new Event("submit"))}},{key:"hideDropdown",value:function(){var e=this.getCurrentHook();e&&e.list.hide()}},{key:"resetFilters",value:function(){var e=this.getCurrentHook();if(e){var t=e.list.data||[],n=t.map(function(e){var t=e;return t.droplab_hidden=!1,t});e.list.render(n)}}}]),e}();window.gl=window.gl||{},gl.FilteredSearchDropdown=i},"./filtered_search/filtered_search_dropdown_manager.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./droplab/drop_lab.js"),a=n("./filtered_search/container.js"),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments[1],i=arguments[2];r(this,e),this.container=a.a.container,this.baseEndpoint=t.replace(/\/$/,""),this.tokenizer=n,this.filteredSearchTokenKeys=gl.FilteredSearchTokenKeys,this.filteredSearchInput=this.container.querySelector(".filtered-search"),this.page=i,this.setupMapping(),this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper)}return o(e,[{key:"cleanup",value:function(){this.droplab&&(this.droplab.destroy(),this.droplab=null),this.setupMapping(),document.removeEventListener("beforeunload",this.cleanupWrapper)}},{key:"setupMapping",value:function(){this.mapping={author:{reference:null,gl:"DropdownUser",element:this.container.querySelector("#js-dropdown-author")},assignee:{reference:null,gl:"DropdownUser",element:this.container.querySelector("#js-dropdown-assignee")},milestone:{reference:null,gl:"DropdownNonUser",extraArguments:[this.baseEndpoint+"/milestones.json","%"],element:this.container.querySelector("#js-dropdown-milestone")},label:{reference:null,gl:"DropdownNonUser",extraArguments:[this.baseEndpoint+"/labels.json","~"],element:this.container.querySelector("#js-dropdown-label")},hint:{reference:null,gl:"DropdownHint",element:this.container.querySelector("#js-dropdown-hint")}}}},{key:"updateCurrentDropdownOffset",value:function(){this.updateDropdownOffset(this.currentDropdown)}},{key:"updateDropdownOffset",value:function(e){var t=this.filteredSearchInput.getBoundingClientRect().left-this.container.querySelector(".scroll-container").getBoundingClientRect().left,n=this.mapping[e].element.clientWidth||240,r=this.container.querySelector(".scroll-container").clientWidth-n;r<t&&(t=r),this.mapping[e].reference.setOffset(t)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.mapping[e],r=n.gl,i=n.element,a=!1;if(!n.reference){var o=this.droplab,s=[null,o,i,this.filteredSearchInput,this.filteredSearchTokenKeys,e],l=s.concat(n.extraArguments||[]);n.reference=new(Function.prototype.bind.apply(gl[r],l))}t&&n.reference.init(),"hint"===this.currentDropdown&&(a=!0),this.updateDropdownOffset(e),n.reference.render(t,a),this.currentDropdown=e}},{key:"loadDropdown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!1;this.droplab||(t=!0,this.droplab=new i.a);var n=this.filteredSearchTokenKeys.searchByKey(e.toLowerCase()),r=n&&this.currentDropdown!==n.key&&this.mapping[n.key],a=!n&&"hint"!==this.currentDropdown;if(r||a){var o=n&&n.key?n.key:"hint";this.load(o,t)}}},{key:"setDropdown",value:function(){var e=gl.DropdownUtils.getSearchQuery(!0),t=this.tokenizer.processTokens(e,this.filteredSearchTokenKeys.getKeys()),n=t.lastToken,r=t.searchToken;if(this.currentDropdown&&this.updateCurrentDropdownOffset(),n===r&&null!==n){var i=n.split(":"),a=i[0].split(" ").last();this.loadDropdown(i.length>1?a:"")}else n?this.loadDropdown(n.key):this.loadDropdown("hint")}},{key:"resetDropdowns",value:function(){this.currentDropdown&&(this.mapping[this.currentDropdown].reference.hideDropdown(),this.setDropdown(),this.mapping[this.currentDropdown].reference.resetFilters(),this.updateDropdownOffset(this.currentDropdown))}},{key:"destroyDroplab",value:function(){this.droplab.destroy()}}],[{key:"addWordToInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=a.a.container.querySelector(".filtered-search");gl.FilteredSearchVisualTokens.addFilterVisualToken(e,t),r.value="",n&&gl.FilteredSearchVisualTokens.moveInputToTheRight()}}]),e}();window.gl=window.gl||{},gl.FilteredSearchDropdownManager=s},"./filtered_search/filtered_search_manager.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./filtered_search/container.js"),a=n("./filtered_search/recent_searches_root.js"),o=n("./filtered_search/stores/recent_searches_store.js"),s=n("./filtered_search/services/recent_searches_service.js"),l=n("./filtered_search/event_hub.js"),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){r(this,e),this.page=t,this.container=i.a.container,this.filteredSearchInput=this.container.querySelector(".filtered-search"),this.filteredSearchInputForm=this.filteredSearchInput.form,this.clearSearchButton=this.container.querySelector(".clear-search"),this.tokensContainer=this.container.querySelector(".tokens-container"),this.filteredSearchTokenKeys=gl.FilteredSearchTokenKeys,this.recentSearchesStore=new o.a({isLocalStorageAvailable:s.a.isAvailable(),allowedKeys:this.filteredSearchTokenKeys.getKeys()}),this.searchHistoryDropdownElement=document.querySelector(".js-filtered-search-history-dropdown");var n=this.searchHistoryDropdownElement?this.searchHistoryDropdownElement.dataset.projectFullPath:"project",a="issue-recent-searches";"merge_requests"===this.page&&(a="merge-request-recent-searches");var l=n+"-"+a;this.recentSearchesService=new s.a(l)}return c(e,[{key:"setup",value:function(){var e=this;this.fetchingRecentSearchesPromise=this.recentSearchesService.fetch().catch(function(e){if("RecentSearchesServiceError"!==e.name)return new window.Flash("An error occured while parsing recent searches"),[]}).then(function(t){var n=e.recentSearchesStore.setRecentSearches(e.recentSearchesStore.state.recentSearches.concat(t));e.recentSearchesService.save(n)}),this.filteredSearchInput&&(this.tokenizer=gl.FilteredSearchTokenizer,this.dropdownManager=new gl.FilteredSearchDropdownManager(this.filteredSearchInput.getAttribute("data-base-endpoint")||"",this.tokenizer,this.page),this.recentSearchesRoot=new a.a(this.recentSearchesStore,this.recentSearchesService,this.searchHistoryDropdownElement),this.recentSearchesRoot.init(),this.bindEvents(),this.loadSearchParamsFromURL(),this.dropdownManager.setDropdown(),this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper))}},{key:"cleanup",value:function(){this.unbindEvents(),document.removeEventListener("beforeunload",this.cleanupWrapper),this.recentSearchesRoot&&this.recentSearchesRoot.destroy()}},{key:"bindStateEvents",value:function(){this.stateFilters=document.querySelector(".container-fluid .issues-state-filters"),this.stateFilters&&(this.searchStateWrapper=this.searchState.bind(this),this.stateFilters.querySelector('[data-state="opened"]').addEventListener("click",this.searchStateWrapper),this.stateFilters.querySelector('[data-state="closed"]').addEventListener("click",this.searchStateWrapper),this.stateFilters.querySelector('[data-state="all"]').addEventListener("click",this.searchStateWrapper),this.mergedState=this.stateFilters.querySelector('[data-state="merged"]'),this.mergedState&&this.mergedState.addEventListener("click",this.searchStateWrapper))}},{key:"unbindStateEvents",value:function(){this.stateFilters&&(this.stateFilters.querySelector('[data-state="opened"]').removeEventListener("click",this.searchStateWrapper),this.stateFilters.querySelector('[data-state="closed"]').removeEventListener("click",this.searchStateWrapper),this.stateFilters.querySelector('[data-state="all"]').removeEventListener("click",this.searchStateWrapper),this.mergedState&&this.mergedState.removeEventListener("click",this.searchStateWrapper))}},{key:"bindEvents",value:function(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.setDropdownWrapper=this.dropdownManager.setDropdown.bind(this.dropdownManager),this.toggleClearSearchButtonWrapper=this.toggleClearSearchButton.bind(this),this.handleInputPlaceholderWrapper=this.handleInputPlaceholder.bind(this),this.handleInputVisualTokenWrapper=this.handleInputVisualToken.bind(this),this.checkForEnterWrapper=this.checkForEnter.bind(this),this.onClearSearchWrapper=this.onClearSearch.bind(this),this.checkForBackspaceWrapper=this.checkForBackspace.bind(this),this.removeSelectedTokenKeydownWrapper=this.removeSelectedTokenKeydown.bind(this),this.unselectEditTokensWrapper=this.unselectEditTokens.bind(this),this.editTokenWrapper=this.editToken.bind(this),this.tokenChange=this.tokenChange.bind(this),this.addInputContainerFocusWrapper=this.addInputContainerFocus.bind(this),this.removeInputContainerFocusWrapper=this.removeInputContainerFocus.bind(this),this.onrecentSearchesItemSelectedWrapper=this.onrecentSearchesItemSelected.bind(this),this.removeTokenWrapper=this.removeToken.bind(this),this.filteredSearchInputForm.addEventListener("submit",this.handleFormSubmit),this.filteredSearchInput.addEventListener("input",this.setDropdownWrapper),this.filteredSearchInput.addEventListener("input",this.toggleClearSearchButtonWrapper),this.filteredSearchInput.addEventListener("input",this.handleInputPlaceholderWrapper),this.filteredSearchInput.addEventListener("input",this.handleInputVisualTokenWrapper),this.filteredSearchInput.addEventListener("keydown",this.checkForEnterWrapper),this.filteredSearchInput.addEventListener("keyup",this.checkForBackspaceWrapper),this.filteredSearchInput.addEventListener("click",this.tokenChange),this.filteredSearchInput.addEventListener("keyup",this.tokenChange),this.filteredSearchInput.addEventListener("focus",this.addInputContainerFocusWrapper),this.tokensContainer.addEventListener("click",this.removeTokenWrapper),this.tokensContainer.addEventListener("click",this.editTokenWrapper),this.clearSearchButton.addEventListener("click",this.onClearSearchWrapper),document.addEventListener("click",this.unselectEditTokensWrapper),document.addEventListener("click",this.removeInputContainerFocusWrapper),document.addEventListener("keydown",this.removeSelectedTokenKeydownWrapper),l.a.$on("recentSearchesItemSelected",this.onrecentSearchesItemSelectedWrapper),this.bindStateEvents()}},{key:"unbindEvents",value:function(){this.filteredSearchInputForm.removeEventListener("submit",this.handleFormSubmit),this.filteredSearchInput.removeEventListener("input",this.setDropdownWrapper),this.filteredSearchInput.removeEventListener("input",this.toggleClearSearchButtonWrapper),this.filteredSearchInput.removeEventListener("input",this.handleInputPlaceholderWrapper),this.filteredSearchInput.removeEventListener("input",this.handleInputVisualTokenWrapper),this.filteredSearchInput.removeEventListener("keydown",this.checkForEnterWrapper),this.filteredSearchInput.removeEventListener("keyup",this.checkForBackspaceWrapper),this.filteredSearchInput.removeEventListener("click",this.tokenChange),this.filteredSearchInput.removeEventListener("keyup",this.tokenChange),this.filteredSearchInput.removeEventListener("focus",this.addInputContainerFocusWrapper),this.tokensContainer.removeEventListener("click",this.removeTokenWrapper),this.tokensContainer.removeEventListener("click",this.editTokenWrapper),this.clearSearchButton.removeEventListener("click",this.onClearSearchWrapper),document.removeEventListener("click",this.unselectEditTokensWrapper),document.removeEventListener("click",this.removeInputContainerFocusWrapper),document.removeEventListener("keydown",this.removeSelectedTokenKeydownWrapper),l.a.$off("recentSearchesItemSelected",this.onrecentSearchesItemSelectedWrapper),this.unbindStateEvents()}},{key:"checkForBackspace",value:function(e){if(8===e.keyCode||46===e.keyCode){var t=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),n=t.lastVisualToken,r=n&&n.querySelector(".name").textContent.trim(),i=r&&this.canEdit&&this.canEdit(r);""===this.filteredSearchInput.value&&n&&i&&(this.filteredSearchInput.value=gl.FilteredSearchVisualTokens.getLastTokenPartial(),gl.FilteredSearchVisualTokens.removeLastTokenPartial()),this.dropdownManager.updateCurrentDropdownOffset()}}},{key:"checkForEnter",value:function(e){if(38===e.keyCode||40===e.keyCode){var t=this.filteredSearchInput.selectionStart;e.preventDefault(),this.filteredSearchInput.setSelectionRange(t,t)}if(13===e.keyCode){var n=this.dropdownManager.mapping[this.dropdownManager.currentDropdown],r=n.element,i=r.querySelectorAll(".droplab-item-active");e.preventDefault(),i.length||(this.isHandledAsync?(e.stopImmediatePropagation(),this.filteredSearchInput.blur(),this.dropdownManager.resetDropdowns()):this.dropdownManager.destroyDroplab(),this.search())}}},{key:"addInputContainerFocus",value:function(){var e=this.filteredSearchInput.closest(".filtered-search-box");e&&e.classList.add("focus")}},{key:"removeInputContainerFocus",value:function(e){var t=this.filteredSearchInput.closest(".filtered-search-box"),n=t&&t.contains(e.target),r=null!==e.target.closest(".filter-dropdown"),i=null!==e.target.closest("ul[data-dropdown]");n||r||i||!t||t.classList.remove("focus")}},{key:"removeToken",value:function(e){if(e.target.closest(".remove-token")){e.preventDefault(),e.stopImmediatePropagation();var t=e.target.closest(".selectable");gl.FilteredSearchVisualTokens.selectToken(t,!0),this.removeSelectedToken()}}},{key:"unselectEditTokens",value:function(e){var t=this.container.querySelector(".filtered-search-box"),n=t&&t.contains(e.target),r=null!==e.target.closest(".filter-dropdown"),i=e.target.classList.contains("tokens-container");(!n&&!r||i)&&(gl.FilteredSearchVisualTokens.moveInputToTheRight(),this.dropdownManager.resetDropdowns())}},{key:"editToken",value:function(e){var t=e.target.closest(".js-visual-token"),n=t&&t.querySelector(".name").textContent.trim(),r=this.canEdit&&this.canEdit(n);t&&r&&(e.preventDefault(),e.stopPropagation(),gl.FilteredSearchVisualTokens.editToken(t),this.tokenChange())}},{key:"toggleClearSearchButton",value:function(){var e=gl.DropdownUtils.getSearchQuery(),t=this.clearSearchButton.classList.contains("hidden");0!==e.length||t?e.length&&t&&this.clearSearchButton.classList.remove("hidden"):this.clearSearchButton.classList.add("hidden")}},{key:"handleInputPlaceholder",value:function(){var e=gl.DropdownUtils.getSearchQuery(),t=this.filteredSearchInput.placeholder;0===e.length&&"Search or filter results..."!==t?this.filteredSearchInput.placeholder="Search or filter results...":e.length>0&&""!==t&&(this.filteredSearchInput.placeholder="")}},{key:"removeSelectedTokenKeydown",value:function(e){8!==e.keyCode&&46!==e.keyCode||this.removeSelectedToken()}},{key:"removeSelectedToken",value:function(){gl.FilteredSearchVisualTokens.removeSelectedToken(),this.handleInputPlaceholder(),this.toggleClearSearchButton(),this.dropdownManager.updateCurrentDropdownOffset()}},{key:"onClearSearch",value:function(e){e.preventDefault(),this.clearSearch()}},{key:"clearSearch",value:function(){this.filteredSearchInput.value="";var e=[];[].forEach.call(this.tokensContainer.children,function(t){t.classList.contains("js-visual-token")&&e.push(t)}),e.forEach(function(e){e.parentElement.removeChild(e)}),this.clearSearchButton.classList.add("hidden"),this.handleInputPlaceholder(),this.dropdownManager.resetDropdowns(),this.isHandledAsync&&this.search()}},{key:"handleInputVisualToken",value:function(){var e=this.filteredSearchInput,t=this.tokenizer.processTokens(e.value,this.filteredSearchTokenKeys.getKeys()),n=t.tokens,r=t.searchToken;if(gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput().isLastVisualTokenValid){n.forEach(function(t){e.value=e.value.replace(t.key+":"+t.symbol+t.value,""),gl.FilteredSearchVisualTokens.addFilterVisualToken(t.key,""+t.symbol+t.value)});var i=r.split(":");if(i.length>1){var a=i[0].split(" "),o=a.last();if(a.length>1){a.pop();var s=a.join(" ");e.value=e.value.replace(s,""),gl.FilteredSearchVisualTokens.addSearchVisualToken(s)}gl.FilteredSearchVisualTokens.addFilterVisualToken(o),e.value=e.value.replace(o+":","")}}else{var l=/([~%@]{0,1}".+")|([~%@]{0,1}'.+')|^((?![~%@]')(?![~%@]")(?!')(?!")).*/g;r.match(l)&&" "===e.value[e.value.length-1]&&(gl.FilteredSearchVisualTokens.addFilterVisualToken(r),e.value=e.value.replace(r,"").trim())}}},{key:"handleFormSubmit",value:function(e){e.preventDefault(),this.search()}},{key:"saveCurrentSearchQuery",value:function(){var e=this;this.fetchingRecentSearchesPromise.then(function(){var t=gl.DropdownUtils.getSearchQuery();if(t.length>0){var n=e.recentSearchesStore.addRecentSearch(t);e.recentSearchesService.save(n)}}).catch(function(){})}},{key:"loadSearchParamsFromURL",value:function(){var e=this,t=gl.utils.getUrlParamsArray(),n=this.getUsernameParams(),r=!1;t.forEach(function(t){var i=t.split("="),a=decodeURIComponent(i[0]),o=i[1],s=e.filteredSearchTokenKeys.searchByConditionUrl(t);if(s){r=!0;var l=e.canEdit&&e.canEdit(s.tokenKey);gl.FilteredSearchVisualTokens.addFilterVisualToken(s.tokenKey,s.value,l)}else{var c=o?decodeURIComponent(o.replace(/\+/g," ")):o,u=e.filteredSearchTokenKeys.searchByKeyParam(a);if(u){var d=a.indexOf("_"),h=-1!==d?a.slice(0,a.indexOf("_")):a,p=u.symbol,f="";-1!==c.indexOf(" ")&&(f=-1===c.indexOf('"')?'"':"'"),r=!0;var v=e.canEdit&&e.canEdit(h);gl.FilteredSearchVisualTokens.addFilterVisualToken(h,""+p+f+c+f,v)}else if(u||"assignee_id"!==a)if(u||"author_id"!==a)u||"search"!==a||(r=!0,e.filteredSearchInput.value=c);else{var y=parseInt(o,10);if(n[y]){r=!0;var k=e.canEdit&&e.canEdit("author");gl.FilteredSearchVisualTokens.addFilterVisualToken("author","@"+n[y],k)}}else{var g=parseInt(o,10);if(n[g]){r=!0;var m=e.canEdit&&e.canEdit("assignee");gl.FilteredSearchVisualTokens.addFilterVisualToken("assignee","@"+n[g],m)}}}}),this.saveCurrentSearchQuery(),r&&(this.clearSearchButton.classList.remove("hidden"),this.handleInputPlaceholder())}},{key:"searchState",value:function(e){e.preventDefault();var t=e.currentTarget;t.blur();var n=t.dataset&&t.dataset.state;n&&this.search(n)}},{key:"search",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=[],r=gl.DropdownUtils.getSearchQuery();this.saveCurrentSearchQuery();var i=this.tokenizer.processTokens(r,this.filteredSearchTokenKeys.getKeys()),a=i.tokens,o=i.searchToken,s=t||gl.utils.getParameterByName("state")||"opened";if(n.push("state="+s),a.forEach(function(t){var r=e.filteredSearchTokenKeys.searchByConditionKeyValue(t.key,t.value.toLowerCase()),i=e.filteredSearchTokenKeys.searchByKey(t.key)||{},a=i.param,o=a?t.key+"_"+a:t.key,s="";if(r)s=r.url;else{var l=t.value;("'"===l[0]&&"'"===l[l.length-1]||'"'===l[0]&&'"'===l[l.length-1])&&(l=l.slice(1,l.length-1)),s=o+"="+encodeURIComponent(l)}n.push(s)}),o){var l=o.split(" ").map(function(e){return encodeURIComponent(e)}).join("+");n.push("search="+l)}var c="?scope=all&utf8=%E2%9C%93&"+n.join("&");this.updateObject?this.updateObject(c):gl.utils.visitUrl(c)}},{key:"getUsernameParams",value:function(){var e={};try{var t=this.filteredSearchInput.getAttribute("data-username-params");JSON.parse(t).forEach(function(t){e[t.id]=t.username})}catch(e){}return e}},{key:"tokenChange",value:function(){var e=this.dropdownManager.mapping[this.dropdownManager.currentDropdown];if(e){var t=e.reference;this.setDropdownWrapper(),t.dispatchInputEvent()}}},{key:"onrecentSearchesItemSelected",value:function(e){this.clearSearch(),this.filteredSearchInput.value=e,this.filteredSearchInput.dispatchEvent(new CustomEvent("input")),this.search()}},{key:"canEdit",value:function(){return!0}}]),e}();window.gl=window.gl||{},gl.FilteredSearchManager=u},"./filtered_search/filtered_search_token_keys.js":function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=[{key:"author",type:"string",param:"username",symbol:"@",icon:"pencil"},{key:"assignee",type:"string",param:"username",symbol:"@",icon:"user"},{key:"milestone",type:"string",param:"title",symbol:"%",icon:"clock-o"},{key:"label",type:"array",param:"name[]",symbol:"~",icon:"tag"}],a=[{key:"label",type:"string",param:"name",symbol:"~"}],o=i.concat(a),s=[{url:"assignee_id=0",tokenKey:"assignee",value:"none"},{url:"milestone_title=No+Milestone",tokenKey:"milestone",value:"none"},{url:"milestone_title=%23upcoming",tokenKey:"milestone",value:"upcoming"},{url:"milestone_title=%23started",tokenKey:"milestone",value:"started"},{url:"label_name[]=No+Label",tokenKey:"label",value:"none"}],l=function(){function e(){n(this,e)}return r(e,null,[{key:"get",value:function(){return i}},{key:"getKeys",value:function(){return i.map(function(e){return e.key})}},{key:"getAlternatives",value:function(){return a}},{key:"getConditions",value:function(){return s}},{key:"searchByKey",value:function(e){return i.find(function(t){return t.key===e})||null}},{key:"searchBySymbol",value:function(e){return i.find(function(t){return t.symbol===e})||null}},{key:"searchByKeyParam",value:function(e){return o.find(function(t){var n=t.key;return t.param&&(n+="_"+t.param),e===n})||null}},{key:"searchByConditionUrl",value:function(e){return s.find(function(t){return t.url===e})||null}},{key:"searchByConditionKeyValue",value:function(e,t){return s.find(function(n){return n.tokenKey===e&&n.value===t})||null}}]),e}();window.gl=window.gl||{},gl.FilteredSearchTokenKeys=l},"./filtered_search/filtered_search_tokenizer.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./filtered_search/filtered_search_token_keys.js"),a=(n.n(i),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),o=function(){function e(){r(this,e)}return a(e,null,[{key:"processTokens",value:function(e,t){var n=new RegExp("("+t.join("|")+"):([~%@]?)(?:('[^']*'{0,1})|(\"[^\"]*\"{0,1})|(\\S+))","g"),r=[],i=[],a=null,o=e.replace(n,function(e,t,n,a,o,s){var l=a||o||s,c=n,u="";return"~"!==l&&"%"!==l&&"@"!==l||(c=l,l=""),u=t+":"+l,-1===i.indexOf(u)&&(i.push(u),r.push({key:t,value:l||"",symbol:c||""})),""}).replace(/\s{2,}/g," ").trim()||"";if(r.length>0){var s=r[r.length-1],l=s.key+":"+s.symbol+s.value;a=e.lastIndexOf(l)===e.length-l.length?s:o}else a=o;return{tokens:r,lastToken:a,searchToken:o}}}]),e}();window.gl=window.gl||{},gl.FilteredSearchTokenizer=o},"./filtered_search/filtered_search_visual_tokens.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./lib/utils/ajax_cache.js"),a=n("./flash.js"),o=(n.n(a),n("./filtered_search/container.js")),s=n("./lib/utils/users_cache.js"),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(){r(this,e)}return l(e,null,[{key:"getLastVisualTokenBeforeInput",value:function(){var e=o.a.container.querySelector(".input-token"),t=e&&e.previousElementSibling;return{lastVisualToken:t,isLastVisualTokenValid:null===t||-1!==t.className.indexOf("filtered-search-term")||t&&null!==t.querySelector(".value")}}},{key:"unselectTokens",value:function(){var e=o.a.container.querySelectorAll(".js-visual-token .selectable.selected");[].forEach.call(e,function(e){return e.classList.remove("selected")})}},{key:"selectToken",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.classList.contains("selected");e.unselectTokens(),r&&!n||t.classList.add("selected")}},{key:"removeSelectedToken",value:function(){var e=o.a.container.querySelector(".js-visual-token .selected");if(e){var t=e.closest(".js-visual-token");t.parentElement.removeChild(t)}}},{key:"createVisualTokenElementHTML",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t="";return e&&(t='\n        <div class="remove-token" role="button">\n          <i class="fa fa-close"></i>\n        </div>\n      '),'\n      <div class="selectable" role="button">\n        <div class="name"></div>\n        <div class="value-container">\n          <div class="value"></div>\n          '+t+"\n        </div>\n      </div>\n    "}},{key:"updateLabelTokenColor",value:function(e,t){var n=o.a.container.querySelector(".filtered-search"),r=n.dataset.baseEndpoint,a=r+"/labels.json";return i.a.retrieve(a).then(function(n){var r=(n||[]).find(function(e){return"~"+gl.DropdownUtils.getEscapedText(e.title)===t});if(r){var i=e.style;if(i.backgroundColor=r.color,i.color=r.text_color,"#FFFFFF"===r.text_color){e.querySelector(".remove-token").classList.add("inverted")}}}).catch(function(){return new Flash("An error occurred while fetching label colors.")})}},{key:"updateUserTokenAppearance",value:function(e,t,n){if("none"===n)return Promise.resolve();var r=n.replace(/^@/,"");return s.a.retrieve(r).then(function(r){r&&(e.dataset.originalValue=n,t.innerHTML='\n          <img class="avatar s20" src="'+r.avatar_url+'" alt="'+r.name+"'s avatar\">\n          "+r.name+"\n        ")}).catch(function(){})}},{key:"renderVisualTokenValue",value:function(t,n,r){var i=t.querySelector(".value-container"),a=i.querySelector(".value");a.innerText=r;var o=n.toLowerCase();"label"===o?e.updateLabelTokenColor(i,r):"author"!==o&&"assignee"!==o||e.updateUserTokenAppearance(i,a,r)}},{key:"addVisualTokenElement",value:function(t,n,r,i){var a=document.createElement("li");a.classList.add("js-visual-token"),a.classList.add(r?"filtered-search-term":"filtered-search-token"),n?(a.innerHTML=e.createVisualTokenElementHTML(i),e.renderVisualTokenValue(a,t,n)):a.innerHTML='<div class="name"></div>',a.querySelector(".name").innerText=t;var s=o.a.container.querySelector(".tokens-container"),l=o.a.container.querySelector(".filtered-search");s.insertBefore(a,l.parentElement)}},{key:"addValueToPreviousVisualTokenElement",value:function(t){var n=e.getLastVisualTokenBeforeInput(),r=n.lastVisualToken;if(!n.isLastVisualTokenValid&&r.classList.contains("filtered-search-token")){var i=e.getLastTokenPartial();r.innerHTML=e.createVisualTokenElementHTML(),r.querySelector(".name").innerText=i,e.renderVisualTokenValue(r,i,t)}}},{key:"addFilterVisualToken",value:function(t,n,r){var i=e.getLastVisualTokenBeforeInput(),a=i.lastVisualToken,s=i.isLastVisualTokenValid,l=e.addVisualTokenElement;if(s)l(t,n,!1,r);else{var c=a.querySelector(".name").innerText;o.a.container.querySelector(".tokens-container").removeChild(a);l(c,n||t,!1,r)}}},{key:"addSearchVisualToken",value:function(t){var n=e.getLastVisualTokenBeforeInput(),r=n.lastVisualToken;r&&r.classList.contains("filtered-search-term")?r.querySelector(".name").innerText+=" "+t:e.addVisualTokenElement(t,null,!0)}},{key:"getLastTokenPartial",value:function(){var t=e.getLastVisualTokenBeforeInput(),n=t.lastVisualToken;if(!n)return"";var r=n.querySelector(".value-container"),i=r&&r.dataset.originalValue;if(i)return i;var a=n.querySelector(".value"),o=n.querySelector(".name"),s=a?a.innerText:"",l=o?o.innerText:"";return s||l}},{key:"removeLastTokenPartial",value:function(){var t=e.getLastVisualTokenBeforeInput(),n=t.lastVisualToken;if(n){if(n.querySelector(".value")){var r=n.querySelector(".selectable"),i=n.querySelector(".value-container");r.removeChild(i),n.innerHTML=r.innerHTML}else n.closest(".tokens-container").removeChild(n)}}},{key:"tokenizeInput",value:function(){var t=o.a.container.querySelector(".filtered-search"),n=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),r=n.isLastVisualTokenValid;t.value&&(r?gl.FilteredSearchVisualTokens.addSearchVisualToken(t.value):e.addValueToPreviousVisualTokenElement(t.value),t.value="")}},{key:"editToken",value:function(t){var n=o.a.container.querySelector(".filtered-search");e.tokenizeInput();var r=t.parentElement,i=n.parentElement;r.replaceChild(i,t);var a=t.querySelector(".name"),s=void 0;if(t.classList.contains("filtered-search-token")){e.addFilterVisualToken(a.innerText);var l=t.querySelector(".value-container");if(!(s=l.dataset.originalValue)){s=l.querySelector(".value").innerText}}s||(s=a.innerText),n.value=s;var c=new Event("input");n.dispatchEvent(c),n.focus()}},{key:"moveInputToTheRight",value:function(){var t=o.a.container.querySelector(".filtered-search");if(t){var n=t.parentElement,r=o.a.container.querySelector(".tokens-container");if(e.tokenizeInput(),!r.lastElementChild.isEqualNode(n)){if(!gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput().isLastVisualTokenValid){var i=gl.FilteredSearchVisualTokens.getLastTokenPartial();gl.FilteredSearchVisualTokens.removeLastTokenPartial(),gl.FilteredSearchVisualTokens.addSearchVisualToken(i)}r.removeChild(n),r.appendChild(n)}}}}]),e}();window.gl=window.gl||{},gl.FilteredSearchVisualTokens=c},"./filtered_search/recent_searches_root.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("../../../node_modules/vue/dist/vue.esm.js"),a=n("./filtered_search/components/recent_searches_dropdown_content.js"),o=n("./filtered_search/event_hub.js"),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(){function e(t,n,i){r(this,e),this.store=t,this.service=n,this.wrapperElement=i}return s(e,[{key:"init",value:function(){this.bindEvents(),this.render()}},{key:"bindEvents",value:function(){this.onRequestClearRecentSearchesWrapper=this.onRequestClearRecentSearches.bind(this),o.a.$on("requestClearRecentSearches",this.onRequestClearRecentSearchesWrapper)}},{key:"unbindEvents",value:function(){o.a.$off("requestClearRecentSearches",this.onRequestClearRecentSearchesWrapper)}},{key:"render",value:function(){var e=this.store.state;this.vm=new i.default({el:this.wrapperElement,data:function(){return e},template:'\n        <recent-searches-dropdown-content\n          :items="recentSearches"\n          :is-local-storage-available="isLocalStorageAvailable"\n          :allowed-keys="allowedKeys"\n          />\n      ',components:{"recent-searches-dropdown-content":a.a}})}},{key:"onRequestClearRecentSearches",value:function(){var e=this.store.setRecentSearches([]);this.service.save(e)}},{key:"destroy",value:function(){this.unbindEvents(),this.vm&&this.vm.$destroy()}}]),e}();t.a=l},"./filtered_search/services/recent_searches_service.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./filtered_search/services/recent_searches_service_error.js"),a=n("./lib/utils/accessor.js"),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"issuable-recent-searches";r(this,e),this.localStorageKey=t}return o(e,[{key:"fetch",value:function(){if(!e.isAvailable()){var t=new i.a;return Promise.reject(t)}var n=window.localStorage.getItem(this.localStorageKey),r=[];if(n&&n.length>0)try{r=JSON.parse(n)}catch(e){return Promise.reject(e)}return Promise.resolve(r)}},{key:"save",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.isAvailable()&&window.localStorage.setItem(this.localStorageKey,JSON.stringify(t))}}],[{key:"isAvailable",value:function(){return a.a.isLocalStorageAccessSafe()}}]),e}();t.a=s},"./filtered_search/services/recent_searches_service_error.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function e(t){r(this,e),this.name="RecentSearchesServiceError",this.message=t||"Recent Searches Service is unavailable"};i.prototype=Error.prototype,t.a=i},"./filtered_search/stores/recent_searches_store.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("../../../node_modules/underscore/underscore.js"),a=n.n(i),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];r(this,e),this.state=Object.assign({isLocalStorageAvailable:!0,recentSearches:[],allowedKeys:n},t)}return o(e,[{key:"addRecentSearch",value:function(e){return this.setRecentSearches([e].concat(this.state.recentSearches)),this.state.recentSearches}},{key:"setRecentSearches",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map(function(e){return e.trim()});return this.state.recentSearches=a.a.uniq(t).slice(0,5),this.state.recentSearches}}]),e}();t.a=s},"./lib/utils/users_cache.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n("./api.js"),s=n("./lib/utils/cache.js"),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),l(t,[{key:"retrieve",value:function(e){var t=this;return this.hasData(e)?Promise.resolve(this.get(e)):o.a.users("",{username:e}).then(function(n){if(!n.length)throw new Error('User "'+e+'" could not be found!');if(n.length>1)throw new Error('Expected username "'+e+'" to be unique!');var r=n[0];return t.internalStorage[e]=r,r})}}]),t}(s.a);t.a=new c}},["./filtered_search/filtered_search_bundle.js"]);
//# sourceMappingURL=filtered_search.d55dc50a619b68060e16.bundle.js.map