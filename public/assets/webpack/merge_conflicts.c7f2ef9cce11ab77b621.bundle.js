webpackJsonp(["merge_conflicts"],{"./merge_conflicts/components/diff_file_editor.js":function(e,t,i){"use strict";(function(e){function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=i("../../../node_modules/vue/dist/vue.esm.js");!function(i){i.mergeConflicts=i.mergeConflicts||{},i.mergeConflicts.diffFileEditor=n.default.extend({props:{file:Object,onCancelDiscardConfirmation:Function,onAcceptDiscardConfirmation:Function},data:function(){return{saved:!1,loading:!1,fileLoaded:!1,originalContent:""}},computed:{classObject:function(){return{saved:this.saved,"is-loading":this.loading}}},watch:t({},"file.showEditor",function(e){this.resetEditorContent(),!e||this.fileLoaded||this.loading||this.loadEditor()}),mounted:function(){this.file.loadEditor&&this.loadEditor()},methods:{loadEditor:function(){var t=this;this.loading=!0,e.get(this.file.content_path).done(function(e){var i=t.$el.querySelector("pre"),n=document.createTextNode(e.content);i.textContent=n.textContent,t.originalContent=e.content,t.fileLoaded=!0,t.editor=ace.edit(i),t.editor.$blockScrolling=1/0,t.editor.getSession().setMode("ace/mode/"+e.blob_ace_mode),t.editor.on("change",function(){t.saveDiffResolution()}),t.saveDiffResolution()}).fail(function(){new Flash("Failed to load the file, please try again.")}).always(function(){t.loading=!1})},saveDiffResolution:function(){this.saved=!0,this.file.content=this.editor.getValue(),this.file.resolveEditChanged=this.file.content!==this.originalContent,this.file.promptDiscardConfirmation=!1},resetEditorContent:function(){this.fileLoaded&&this.editor.setValue(this.originalContent,-1)},cancelDiscardConfirmation:function(e){this.onCancelDiscardConfirmation(e)},acceptDiscardConfirmation:function(e){this.onAcceptDiscardConfirmation(e)}}})}(window.gl||(window.gl={}))}).call(t,i("../../../node_modules/jquery/dist/jquery.js"))},"./merge_conflicts/components/inline_conflict_lines.js":function(e,t,i){"use strict";var n=i("../../../node_modules/vue/dist/vue.esm.js");!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.inlineConflictLines=n.default.extend({props:{file:Object},mixins:[e.mergeConflicts.utils,e.mergeConflicts.actions]})}(window.gl||(window.gl={}))},"./merge_conflicts/components/parallel_conflict_lines.js":function(e,t,i){"use strict";var n=i("../../../node_modules/vue/dist/vue.esm.js");!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.parallelConflictLines=n.default.extend({props:{file:Object},mixins:[e.mergeConflicts.utils,e.mergeConflicts.actions],template:'\n      <table>\n        <tr class="line_holder parallel" v-for="section in file.parallelLines">\n          <template v-for="line in section">\n            <td class="diff-line-num header" :class="lineCssClass(line)" v-if="line.isHeader"></td>\n            <td class="line_content header" :class="lineCssClass(line)" v-if="line.isHeader">\n              <strong>{{line.richText}}</strong>\n              <button class="btn" @click="handleSelected(file, line.id, line.section)">{{line.buttonTitle}}</button>\n            </td>\n            <td class="diff-line-num old_line" :class="lineCssClass(line)" v-if="!line.isHeader">{{line.lineNumber}}</td>\n            <td class="line_content parallel" :class="lineCssClass(line)" v-if="!line.isHeader" v-html="line.richText"></td>\n          </template>\n        </tr>\n      </table>\n    '})}(window.gl||(window.gl={}))},"./merge_conflicts/merge_conflict_service.js":function(e,t,i){(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(n){n.mergeConflicts=n.mergeConflicts||{};var o=function(){function n(e){t(this,n),this.conflictsPath=e.conflictsPath,this.resolveConflictsPath=e.resolveConflictsPath}return i(n,[{key:"fetchConflictsData",value:function(){return e.ajax({dataType:"json",url:this.conflictsPath})}},{key:"submitResolveConflicts",value:function(t){return e.ajax({url:this.resolveConflictsPath,data:JSON.stringify(t),contentType:"application/json",dataType:"json",method:"POST"})}}]),n}();n.mergeConflicts.mergeConflictsService=o}(window.gl||(window.gl={}))}).call(t,i("../../../node_modules/jquery/dist/jquery.js"))},"./merge_conflicts/merge_conflict_store.js":function(e,t,i){"use strict";(function(e){var t=i("../../../node_modules/vue/dist/vue.esm.js"),n=i("../../../node_modules/js-cookie/src/js.cookie.js"),o=i.n(n);!function(i){i.mergeConflicts=i.mergeConflicts||{};var n=o.a.get("diff_view"),s={INLINE:"inline",PARALLEL:"parallel"},l={TEXT:"text",TEXT_EDITOR:"text-editor"};i.mergeConflicts.mergeConflictsStore={state:{isLoading:!0,hasError:!1,isSubmitting:!1,isParallel:n===s.PARALLEL,diffViewType:n,conflictsData:{}},setConflictsData:function(e){this.decorateFiles(e.files),this.state.conflictsData={files:e.files,commitMessage:e.commit_message,sourceBranch:e.source_branch,targetBranch:e.target_branch,shortCommitSha:e.commit_sha.slice(0,7)}},decorateFiles:function(e){var t=this;e.forEach(function(e){e.content="",e.resolutionData={},e.promptDiscardConfirmation=!1,e.resolveMode="interactive",e.filePath=t.getFilePath(e),e.iconClass="fa-"+e.blob_icon,e.blobPath=e.blob_path,e.type===l.TEXT?(e.showEditor=!1,e.loadEditor=!1,t.setInlineLine(e),t.setParallelLine(e)):e.type===l.TEXT_EDITOR&&(e.showEditor=!0,e.loadEditor=!0)})},setInlineLine:function(e){var t=this;e.inlineLines=[],e.sections.forEach(function(i){var n="new",o=i.conflict,s=i.lines,l=i.id;o&&e.inlineLines.push(t.getHeadHeaderLine(l)),s.forEach(function(i){var s=i.type;"new"!==s&&"old"!==s||n===s||(n=s,e.inlineLines.push({lineType:"emptyLine",richText:""})),t.decorateLineForInlineView(i,l,o),e.inlineLines.push(i)}),o&&e.inlineLines.push(t.getOriginHeaderLine(l))})},setParallelLine:function(e){var t=this;e.parallelLines=[];var i={left:[],right:[]};e.sections.forEach(function(e){var n=e.conflict,o=e.lines,s=e.id;n&&(i.left.push(t.getOriginHeaderLine(s)),i.right.push(t.getHeadHeaderLine(s))),o.forEach(function(e){var o=e.type;if(n)"old"===o?i.left.push(t.getLineForParallelView(e,s,"conflict")):"new"===o&&i.right.push(t.getLineForParallelView(e,s,"conflict",!0));else{var l=o||"context";i.left.push(t.getLineForParallelView(e,s,l)),i.right.push(t.getLineForParallelView(e,s,l,!0))}}),t.checkLineLengths(i)});for(var n=0,o=i.left.length;n<o;n+=1)e.parallelLines.push([i.right[n],i.left[n]])},setLoadingState:function(e){this.state.isLoading=e},setErrorState:function(e){this.state.hasError=e},setFailedRequest:function(e){this.state.hasError=!0,this.state.conflictsData.errorMessage=e},getConflictsCount:function(){if(!this.state.conflictsData.files.length)return 0;var e=this.state.conflictsData.files,t=0;return e.forEach(function(e){e.type===l.TEXT?e.sections.forEach(function(e){e.conflict&&(t+=1)}):t+=1}),t},getConflictsCountText:function(){var e=this.getConflictsCount();return e+" "+(e?"conflicts":"conflict")},setViewType:function(e){this.state.diffView=e,this.state.isParallel=e===s.PARALLEL,o.a.set("diff_view",e)},getHeadHeaderLine:function(e){return{id:e,richText:"HEAD//our changes",buttonTitle:"Use ours",type:"new",section:"head",isHeader:!0,isHead:!0,isSelected:!1,isUnselected:!1}},decorateLineForInlineView:function(e,t,i){var n=e.type;e.id=t,e.hasConflict=i,e.isHead="new"===n,e.isOrigin="old"===n,e.hasMatch="match"===n,e.richText=e.rich_text,e.isSelected=!1,e.isUnselected=!1},getLineForParallelView:function(e,t,i,n){var o=e.old_line,s=e.new_line,l=e.rich_text,c="conflict"===i;return{id:t,lineType:i,hasConflict:c,isHead:c&&n,isOrigin:c&&!n,hasMatch:"match"===i,lineNumber:n?s:o,section:n?"head":"origin",richText:l,isSelected:!1,isUnselected:!1}},getOriginHeaderLine:function(e){return{id:e,richText:"origin//their changes",buttonTitle:"Use theirs",type:"old",section:"origin",isHeader:!0,isOrigin:!0,isSelected:!1,isUnselected:!1}},getFilePath:function(e){var t=e.old_path,i=e.new_path;return t===i?i:t+" â†’ "+i},checkLineLengths:function(e){var t=e.left,i=e.right;if(t.length!==i.length)if(t.length>i.length)for(var n=t.length-i.length,o=0;o<n;o+=1)i.push({lineType:"emptyLine",richText:""});else for(var s=i.length-t.length,l=0;l<s;l+=1)t.push({lineType:"emptyLine",richText:""})},setPromptConfirmationState:function(e,t){e.promptDiscardConfirmation=t},setFileResolveMode:function(e,t){"interactive"===t?e.showEditor=!1:"edit"===t&&(e.showEditor=!0,e.loadEditor=!0,e.resolutionData={},this.restoreFileLinesState(e)),e.resolveMode=t},restoreFileLinesState:function(e){e.inlineLines.forEach(function(e){(e.hasConflict||e.isHeader)&&(e.isSelected=!1,e.isUnselected=!1)}),e.parallelLines.forEach(function(e){var t=e[0],i=e[1],n=t.hasConflict||t.isHeader,o=i.hasConflict||i.isHeader;(n||o)&&(t.isSelected=!1,t.isUnselected=!1,i.isSelected=!1,i.isUnselected=!1)})},isReadyToCommit:function(){for(var t=this.state.conflictsData.files,i=e.trim(this.state.conflictsData.commitMessage).length,n=0,o=0,s=t.length;o<s;o+=1){var c=t[o];if("interactive"===c.resolveMode){var r=0,a=Object.keys(c.resolutionData).length;if(c.type===l.TEXT){for(var f=0,d=c.sections.length;f<d;f+=1)c.sections[f].conflict&&(r+=1);a!==r&&(n+=1)}}else if("edit"===c.resolveMode&&!c.content){n+=1;continue}}return!this.state.isSubmitting&&i&&!n},getCommitButtonText:function(){var e="Commit conflict resolution";return this.state&&this.state.isSubmitting?"Committing...":e},getCommitData:function(){var e={};return e={commit_message:this.state.conflictsData.commitMessage,files:[]},this.state.conflictsData.files.forEach(function(t){var i={old_path:t.old_path,new_path:t.new_path};t.type===l.TEXT?"interactive"===t.resolveMode?i.sections=t.resolutionData:"edit"===t.resolveMode&&(i.content=t.content):t.type===l.TEXT_EDITOR&&(i.content=t.content),e.files.push(i)}),e},handleSelected:function(e,i,n){var o=this;t.default.set(e.resolutionData,i,n),e.inlineLines.forEach(function(e){e.id===i&&(e.hasConflict||e.isHeader)&&o.markLine(e,n)}),e.parallelLines.forEach(function(e){var t=e[0],s=e[1],l=s.id===i||t.id===i,c=t.hasConflict||t.isHeader,r=s.hasConflict||s.isHeader;l&&(c||r)&&(o.markLine(t,n),o.markLine(s,n))})},markLine:function(e,t){"head"===t&&e.isHead?(e.isSelected=!0,e.isUnselected=!1):"origin"===t&&e.isOrigin?(e.isSelected=!0,e.isUnselected=!1):(e.isSelected=!1,e.isUnselected=!0)},setSubmitState:function(e){this.state.isSubmitting=e},fileTextTypePresent:function(){return this.state.conflictsData.files.some(function(e){return e.type===l.TEXT})}}}(window.gl||(window.gl={}))}).call(t,i("../../../node_modules/jquery/dist/jquery.js"))},"./merge_conflicts/merge_conflicts_bundle.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t=i("../../../node_modules/vue/dist/vue.esm.js"),n=(i("./merge_conflicts/merge_conflict_store.js"),i("./merge_conflicts/merge_conflict_service.js")),o=(i.n(n),i("./merge_conflicts/mixins/line_conflict_utils.js")),s=(i.n(o),i("./merge_conflicts/mixins/line_conflict_actions.js"));i.n(s),i("./merge_conflicts/components/diff_file_editor.js"),i("./merge_conflicts/components/inline_conflict_lines.js"),i("./merge_conflicts/components/parallel_conflict_lines.js");e(function(){var i=document.querySelector("#conflicts"),n=gl.mergeConflicts.mergeConflictsStore,o=new gl.mergeConflicts.mergeConflictsService({conflictsPath:i.dataset.conflictsPath,resolveConflictsPath:i.dataset.resolveConflictsPath});gl.MergeConflictsResolverApp=new t.default({el:"#conflicts",data:n.state,components:{"diff-file-editor":gl.mergeConflicts.diffFileEditor,"inline-conflict-lines":gl.mergeConflicts.inlineConflictLines,"parallel-conflict-lines":gl.mergeConflicts.parallelConflictLines},computed:{conflictsCountText:function(){return n.getConflictsCountText()},readyToCommit:function(){return n.isReadyToCommit()},commitButtonText:function(){return n.getCommitButtonText()},showDiffViewTypeSwitcher:function(){return n.fileTextTypePresent()}},created:function(){var t=this;o.fetchConflictsData().done(function(e){"error"===e.type?n.setFailedRequest(e.message):n.setConflictsData(e)}).error(function(){n.setFailedRequest()}).always(function(){n.setLoadingState(!1),t.$nextTick(function(){e(".js-syntax-highlight").syntaxHighlight()})})},methods:{handleViewTypeChange:function(e){n.setViewType(e)},onClickResolveModeButton:function(e,t){if("interactive"===t&&e.resolveEditChanged)return void n.setPromptConfirmationState(e,!0);n.setFileResolveMode(e,t)},acceptDiscardConfirmation:function(e){n.setPromptConfirmationState(e,!1),n.setFileResolveMode(e,"interactive")},cancelDiscardConfirmation:function(e){n.setPromptConfirmationState(e,!1)},commit:function(){n.setSubmitState(!0),o.submitResolveConflicts(n.getCommitData()).done(function(e){window.location.href=e.redirect_to}).error(function(){n.setSubmitState(!1),new Flash("Failed to save merge conflicts resolutions. Please try again!")})}}})})}.call(t,i("../../../node_modules/jquery/dist/jquery.js"))},"./merge_conflicts/mixins/line_conflict_actions.js":function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.actions={methods:{handleSelected:function(e,t,i){gl.mergeConflicts.mergeConflictsStore.handleSelected(e,t,i)}}}}(window.gl||(window.gl={}))},"./merge_conflicts/mixins/line_conflict_utils.js":function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.utils={methods:{lineCssClass:function(e){return{head:e.isHead,origin:e.isOrigin,match:e.hasMatch,selected:e.isSelected,unselected:e.isUnselected}}}}}(window.gl||(window.gl={}))}},["./merge_conflicts/merge_conflicts_bundle.js"]);
//# sourceMappingURL=merge_conflicts.c7f2ef9cce11ab77b621.bundle.js.map