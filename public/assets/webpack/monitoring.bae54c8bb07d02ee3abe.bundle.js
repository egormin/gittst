webpackJsonp(["monitoring"],{"./lib/utils/http_status.js":function(t,e,a){"use strict";e.a={NO_CONTENT:204,OK:200}},"./monitoring/constants.js":function(t,e,a){"use strict";a.d(e,"b",function(){return n}),a.d(e,"a",function(){return s});var i=a("../../../node_modules/d3/d3.js"),r=a.n(i),n=r.a.time.format("%b %d, %Y"),s=r.a.time.format("%H:%M%p")},"./monitoring/deployments.js":function(t,e,a){"use strict";(function(t){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=a("../../../node_modules/d3/d3.js"),n=a.n(r),s=a("./monitoring/constants.js"),o=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),l=function(){function e(t,a){i(this,e),this.width=t,this.height=a,this.endpoint=document.getElementById("js-metrics").dataset.deploymentEndpoint,this.createGradientDef()}return o(e,[{key:"init",value:function(t){this.chartData=t,this.x=n.a.time.scale().range([0,this.width]),this.x.domain(n.a.extent(this.chartData,function(t){return t.time})),this.charts=n.a.selectAll(".prometheus-graph"),this.getData()}},{key:"getData",value:function(){var e=this;t.ajax({url:this.endpoint,dataType:"JSON"}).fail(function(){return new Flash("Error getting deployment information.")}).done(function(t){e.data=t.deployments.reduce(function(t,a){var i=new Date(a.created_at),r=Math.floor(e.x(i));return i.setSeconds(e.chartData[0].time.getSeconds()),r>=0&&t.push({id:a.id,time:i,sha:a.sha,tag:a.tag,ref:a.ref.name,xPos:r}),t},[]),e.plotData()})}},{key:"plotData",value:function(){var t=this;this.charts.each(function(e,a){var i=n.a.select(t.charts[0][a]),r=i.select(".graph-container"),s=i.node().getAttribute("graph-type");t.createLine(r,s),t.createDeployInfoBox(r,s)})}},{key:"createGradientDef",value:function(){n.a.select("body").append("svg").attr({height:0,width:0}).append("defs").append("linearGradient").attr({id:"shadow-gradient"}).append("stop").attr({offset:"0%","stop-color":"#000","stop-opacity":.4}).select(this.selectParentNode).append("stop").attr({offset:"100%","stop-color":"#000","stop-opacity":0})}},{key:"createLine",value:function(t,e){t.append("g").attr({class:"deploy-info"}).selectAll(".deploy-info").data(this.data).enter().append("g").attr({class:function(t){return"deploy-info-"+t.id+"-"+e},transform:function(t){return"translate("+(Math.floor(t.xPos)+1)+", 0)"}}).append("rect").attr({x:1,y:0,height:this.height+1,width:3,fill:"url(#shadow-gradient)"}).select(this.selectParentNode).append("line").attr({class:"deployment-line",x1:0,x2:0,y1:0,y2:this.height+1})}},{key:"createDeployInfoBox",value:function(t,i){t.selectAll(".deploy-info").selectAll(".js-deploy-info-box").data(this.data).enter().select(function(t){return document.querySelector(".deploy-info-"+t.id+"-"+i)}).append("svg").attr({class:"js-deploy-info-box hidden",x:3,y:0,width:92,height:60}).append("rect").attr({class:"rect-text-metric deploy-info-rect rect-metric",x:1,y:1,rx:2,width:90,height:58}).select(this.selectParentNode).append("g").attr({transform:"translate(5, 2)"}).append("text").attr({class:"deploy-info-text text-metric-bold"}).text(e.refText).select(this.selectParentNode).append("text").attr({class:"deploy-info-text",y:18}).text(function(t){return a.i(s.b)(t.time)}).select(this.selectParentNode).append("text").attr({class:"deploy-info-text text-metric-bold",y:38}).text(function(t){return a.i(s.a)(t.time)})}},{key:"mouseOverDeployInfo",value:function(t,a){if(!this.data)return!1;var i=!1;return this.data.forEach(function(r){r.xPos>=t-10&&r.xPos<=t+10&&!i?(i=r.xPos+1,e.toggleDeployTextbox(r,a,!0)):e.toggleDeployTextbox(r,a,!1)}),i}},{key:"selectParentNode",value:function(){return this.parentNode}}],[{key:"toggleDeployTextbox",value:function(t,e,a){n.a.selectAll(".deploy-info-"+t.id+"-"+e+" .js-deploy-info-box").classed("hidden",!a)}},{key:"refText",value:function(t){return t.tag?t.ref:t.sha.slice(0,6)}}]),e}();e.a=l}).call(e,a("../../../node_modules/jquery/dist/jquery.js"))},"./monitoring/monitoring_bundle.js":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("./monitoring/prometheus_graph.js");document.addEventListener("DOMContentLoaded",function t(){return document.removeEventListener("DOMContentLoaded",t,!1),new i.a},!1)},"./monitoring/prometheus_graph.js":function(t,e,a){"use strict";(function(t){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=a("../../../node_modules/d3/d3.js"),n=a.n(r),s=a("./lib/utils/http_status.js"),o=a("./monitoring/deployments.js"),l=a("./lib/utils/common_utils.js"),c=(a.n(l),a("./lib/utils/number_utils.js")),h=a("./flash.js"),d=(a.n(h),a("./monitoring/constants.js")),p=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),u=".prometheus-container",f=".prometheus-graph",m=n.a.bisector(function(t){return t.time}).left,g=100,y=function(){function e(){i(this,e);var a=t(u),r=a.data("has-metrics");if(this.docLink=a.data("doc-link"),this.integrationLink=a.data("prometheus-integration"),this.state="",t(document).ajaxError(function(){}),r){this.margin={top:80,right:180,bottom:80,left:100},this.marginLabelContainer={top:40,right:0,bottom:40,left:0};var n=t(f).parent().width()+g;this.originalWidth=n,this.originalHeight=330,this.width=n-this.margin.left-this.margin.right,this.height=this.originalHeight-this.margin.top-this.margin.bottom,this.backOffRequestCounter=0,this.deployments=new o.a(this.width,this.height),this.configureGraph(),this.init()}else{var s=this.state;this.state=".js-getting-started",this.updateState(s)}}return p(e,[{key:"createGraph",value:function(){var t=this;Object.keys(this.graphSpecificProperties).forEach(function(e){t.graphSpecificProperties[e].data.length>0&&t.plotValues(e)})}},{key:"init",value:function(){var e=this;return this.getData().then(function(a){var i=!0;if(void 0===a?i=!1:Object.keys(a.metrics).forEach(function(t){if("cpu_values"===t||"memory_values"===t){a.metrics[t][0].values.length<=2&&(i=!1)}}),i){t(".prometheus-state").hide(),t(".prometheus-graphs").show(),e.transformData(a),e.createGraph();var r=e.graphSpecificProperties[Object.keys(e.graphSpecificProperties)[0]].data;e.deployments.init(r)}})}},{key:"plotValues",value:function(t){var e=this.graphSpecificProperties[t],a=n.a.time.scale().range([0,this.width]),i=n.a.scale.linear().range([this.height,0]);e.xScale=a,e.yScale=i;var r=f+"[graph-type="+t+"]",s=n.a.select(r).attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.bottom+this.margin.top).append("g").attr("class","graph-container").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),o=n.a.select(r).attr("width",this.originalWidth).attr("height",this.originalHeight).append("g").attr("transform","translate("+this.marginLabelContainer.left+","+this.marginLabelContainer.top+")");a.domain(n.a.extent(e.data,function(t){return t.time})),i.domain([0,n.a.max(e.data.map(function(t){return t.value}))]);var l=n.a.svg.axis().scale(a).ticks(this.commonGraphProperties.axis_no_ticks).orient("bottom"),c=n.a.svg.axis().scale(i).ticks(this.commonGraphProperties.axis_no_ticks).tickSize(-this.width).outerTickSize(0).orient("left");this.createAxisLabelContainers(o,t),s.append("g").attr("class","x-axis").attr("transform","translate(0,"+this.height+")").call(l),s.append("g").attr("class","y-axis").call(c);var h=n.a.svg.area().x(function(t){return a(t.time)}).y0(this.height).y1(function(t){return i(t.value)}).interpolate("linear"),d=n.a.svg.line().x(function(t){return a(t.time)}).y(function(t){return i(t.value)});s.append("path").datum(e.data).attr("d",h).attr("class","metric-area").attr("fill",e.area_fill_color),s.append("path").datum(e.data).attr("class","metric-line").attr("stroke",e.line_color).attr("fill","none").attr("stroke-width",this.commonGraphProperties.area_stroke_width).attr("d",d),s.append("rect").attr("class","prometheus-graph-overlay").attr("width",this.width).attr("height",this.height).on("mousemove",this.handleMouseOverGraph.bind(this,r))}},{key:"createAxisLabelContainers",value:function(t,e){var a=this.graphSpecificProperties[e];t.append("line").attr("class","label-x-axis-line").attr("stroke","#000000").attr("stroke-width","1").attr({x1:10,y1:this.originalHeight-this.margin.top,x2:this.originalWidth-this.margin.right+10,y2:this.originalHeight-this.margin.top}),t.append("line").attr("class","label-y-axis-line").attr("stroke","#000000").attr("stroke-width","1").attr({x1:10,y1:0,x2:10,y2:this.originalHeight-this.margin.top}),t.append("rect").attr("class","rect-axis-text").attr("x",0).attr("y",50).attr("width",30).attr("height",150),t.append("text").attr("class","label-axis-text").attr("text-anchor","middle").attr("transform","translate(15, "+(this.originalHeight-this.margin.top)/2+") rotate(-90)").text(a.graph_legend_title),t.append("rect").attr("class","rect-axis-text").attr("x",this.originalWidth/2-this.margin.right).attr("y",this.originalHeight-100).attr("width",30).attr("height",80),t.append("text").attr("class","label-axis-text").attr("x",this.originalWidth/2-this.margin.right).attr("y",this.originalHeight-this.margin.top).attr("dy",".35em").text("Time"),t.append("rect").attr("x",this.originalWidth-170).attr("y",this.originalHeight/2-60).style("fill",a.area_fill_color).attr("width",20).attr("height",35),t.append("text").attr("class","text-metric-title").attr("x",this.originalWidth-140).attr("y",this.originalHeight/2-50).text("Average"),t.append("text").attr("class","text-metric-usage").attr("x",this.originalWidth-140).attr("y",this.originalHeight/2-25)}},{key:"handleMouseOverGraph",value:function(t){var e=this,i=document.querySelector(t+" .prometheus-graph-overlay"),r=n.a.mouse(i)[0];Object.keys(this.graphSpecificProperties).forEach(function(t){var i=e.graphSpecificProperties[t],s=i.xScale.invert(r),o=m(i.data,s,1),l=i.data[o-1],h=i.data[o],p=s-l.time>h.time-s,u=p?h:l,g=Math.floor(i.xScale(u.time)),y=e.deployments.mouseOverDeployInfo(r,t),x=f+"[graph-type="+t+"]",v=n.a.max(i.data.map(function(t){return t.value})),_=i.yScale(v);n.a.selectAll(x+" .selected-metric-line").remove(),n.a.selectAll(x+" .circle-metric").remove(),n.a.selectAll(x+" .rect-text-metric:not(.deploy-info-rect)").remove();var b=n.a.select(x).select("g");if(b.append("line").attr({class:(y?"hidden":"")+" selected-metric-line",x1:g,y1:i.yScale(0),x2:g,y2:_}),b.append("circle").attr("class","circle-metric").attr("fill",i.line_color).attr("cx",y||g).attr("cy",i.yScale(u.value)).attr("r",e.commonGraphProperties.circle_radius_metric),!y){var k=b.append("svg").attr({class:"rect-text-metric",x:g,y:0});k.append("rect").attr({class:"rect-metric",x:4,y:1,rx:2,width:e.commonGraphProperties.rect_text_width,height:e.commonGraphProperties.rect_text_height}),k.append("text").attr({class:"text-metric text-metric-bold",x:8,y:35}).text(a.i(d.a)(u.time)),k.append("text").attr({class:"text-metric-date",x:8,y:15}).text(a.i(d.b)(u.time));var w=a.i(c.b)(u.value);w+="cpu_values"===t?"%":" MB",n.a.select(x+" .text-metric-usage").text(w)}})}},{key:"configureGraph",value:function(){this.graphSpecificProperties={cpu_values:{area_fill_color:"#edf3fc",line_color:"#5b99f7",graph_legend_title:"CPU Usage (Cores)",data:[],xScale:{},yScale:{}},memory_values:{area_fill_color:"#fca326",line_color:"#fc6d26",graph_legend_title:"Memory Usage (MB)",data:[],xScale:{},yScale:{}}},this.commonGraphProperties={area_stroke_width:2,median_total_characters:8,circle_radius_metric:5,rect_text_width:90,rect_text_height:40,axis_no_ticks:3}}},{key:"getData",value:function(){var e=this;return this.state=".js-loading",this.updateState(),gl.utils.backOff(function(a,i){t.ajax({url:"metrics.json",dataType:"json"}).done(function(t,r,n){n.status===s.a.NO_CONTENT?(e.backOffRequestCounter=e.backOffRequestCounter+=1,e.backOffRequestCounter<3?a():e.backOffRequestCounter>=3&&i(new Error("loading"))):i(t.success?{status:n.status,metrics:t}:new Error("loading"))}).fail(i)}).then(function(t){return t.status===s.a.NO_CONTENT?{}:t.metrics}).catch(function(){var t=e.state;e.state=".js-unable-to-connect",e.updateState(t)})}},{key:"transformData",value:function(t){var e=this;Object.keys(t.metrics).forEach(function(a){if("cpu_values"===a||"memory_values"===a){var i=t.metrics[a][0];e.graphSpecificProperties[a].data=i.values.map(function(t){return{time:new Date(1e3*t[0]),value:t[1]}})}})}},{key:"updateState",value:function(e){var a=t(".prometheus-state");t(".prometheus-graphs").hide(),e&&t(""+e,a).addClass("hidden"),t(""+this.state,a).removeClass("hidden"),t(".prometheus-state").show()}}]),e}();e.a=y}).call(e,a("../../../node_modules/jquery/dist/jquery.js"))}},["./monitoring/monitoring_bundle.js"]);
//# sourceMappingURL=monitoring.bae54c8bb07d02ee3abe.bundle.js.map